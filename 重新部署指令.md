# ä¿®å¤Node.jsç‰ˆæœ¬åé‡æ–°éƒ¨ç½²

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

âœ… ç®¡ç†åå° Dockerfile: Node.js 18 â†’ Node.js 20
âœ… å‰ç«¯ Dockerfile: Node.js 18 â†’ Node.js 20  
âœ… åç«¯ Dockerfile: Node.js 18 â†’ Node.js 20

## ğŸ“‹ é‡æ–°éƒ¨ç½²æ­¥éª¤

### 1. å…ˆä¸Šä¼ ä¿®å¤åçš„æ–‡ä»¶åˆ°EC2

åœ¨æœ¬åœ°æ‰§è¡Œï¼š
```bash
# é‡æ–°æ‰“åŒ…é¡¹ç›®
tar -czf project-fixed.tar.gz \
    --exclude="node_modules" \
    --exclude=".git" \
    --exclude="logs" \
    --exclude="*.log" \
    backend-api \
    nuxt-frontend \
    jiujiu-admin-simple \
    nginx \
    docker-compose.yml \
    .env.production

# ä¸Šä¼ åˆ°EC2
scp -i ./jiujiu_key.pem project-fixed.tar.gz ubuntu@13.218.106.73:~/
```

### 2. åœ¨EC2ä¸Šæ‰§è¡Œéƒ¨ç½²

SSHè¿æ¥åˆ°EC2ï¼š
```bash
ssh -i ./jiujiu_key.pem ubuntu@13.218.106.73
```

åœ¨EC2ä¸Šæ‰§è¡Œï¼š
```bash
# åœæ­¢ç°æœ‰æœåŠ¡
docker-compose down

# æ¸…ç†æ—§é•œåƒï¼ˆé‡è¦ï¼ï¼‰
docker system prune -a -f

# å¤‡ä»½æ—§æ–‡ä»¶
mv backend-api backend-api.backup || true
mv nuxt-frontend nuxt-frontend.backup || true
mv jiujiu-admin-simple jiujiu-admin-simple.backup || true

# è§£å‹æ–°æ–‡ä»¶
tar -xzf project-fixed.tar.gz
rm project-fixed.tar.gz

# ç¡®ä¿.envæ–‡ä»¶é…ç½®æ­£ç¡®
cp .env.production .env
PUBLIC_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)
sed -i "s/your-ec2-public-ip/$PUBLIC_IP/g" .env

# é‡æ–°æ„å»ºï¼ˆä½¿ç”¨Node.js 20ï¼‰
docker-compose build --no-cache

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 30

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
```

### 3. éªŒè¯æ„å»ºæˆåŠŸ

```bash
# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker-compose logs --tail=50

# æ£€æŸ¥å…·ä½“æœåŠ¡
docker-compose logs admin
docker-compose logs frontend  
docker-compose logs backend
```

### 4. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# ç­‰å¾…MySQLå®Œå…¨å¯åŠ¨
sleep 30

# åˆå§‹åŒ–æ•°æ®åº“
docker exec jiujiu-backend node src/db/init.js
```

### 5. æµ‹è¯•è®¿é—®

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
- å‰ç«¯: http://13.218.106.73:3000
- ç®¡ç†åå°: http://13.218.106.73:8080
- API: http://13.218.106.73:3001/api/health

## ğŸ› å¦‚æœè¿˜æœ‰é—®é¢˜

### æ„å»ºå¤±è´¥æ’æŸ¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
docker-compose build --no-cache admin 2>&1 | tee build.log

# æ£€æŸ¥ç‰¹å®šæœåŠ¡
docker-compose up admin
```

### å•ç‹¬æ„å»ºæµ‹è¯•
```bash
# è¿›å…¥ç®¡ç†åå°ç›®å½•
cd jiujiu-admin-simple

# æ‰‹åŠ¨æ„å»ºæµ‹è¯•
docker build -t test-admin .

# æŸ¥çœ‹æ„å»ºè¿‡ç¨‹
docker build --no-cache -t test-admin . 2>&1 | tee build-debug.log
```

### ç‰ˆæœ¬éªŒè¯
```bash
# éªŒè¯Node.jsç‰ˆæœ¬
docker run --rm node:20-alpine node --version
# åº”è¯¥æ˜¾ç¤º v20.x.x
```