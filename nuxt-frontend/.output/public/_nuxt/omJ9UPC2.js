import{_ as J,a as O}from"./BKRz7CiX.js";import{f as R,u as B,r as f,c as _,o as v,K as W,a as e,z as h,F as T,l as L,n as V,t as m,O as D,_ as z,P as H,Q as G,h as U,M as K,g as Q,C as j,b as A,H as F,m as x,d as q,D as X,w as Y,R as Z,e as ee}from"./EcDhdyxl.js";import{u as ae}from"./Bc9UkeLm.js";import{n as oe}from"./OKUTmN9V.js";import"./Dw_Z4xcU.js";const se={class:"modal-container"},te={class:"modal-header"},ne={class:"modal-body"},le={class:"avatar-preview"},re=["src"],ie={class:"avatar-options"},ce={class:"default-avatars"},ue=["onClick"],de=["src","alt"],pe={class:"upload-section"},ve={class:"upload-btn"},ge={class:"modal-footer"},fe=["disabled"],_e=R({__name:"ChangeAvatarModal",emits:["close"],setup($,{emit:l}){var y,k;const b=l,u=B(),c=f(((y=u.user)==null?void 0:y.avatar)||"/images/head1.png"),o=f(((k=u.user)==null?void 0:k.avatar)||"/images/head1.png"),i=f(!1),p=f(null),g=r=>{c.value=r,o.value=r,p.value=null},C=r=>{var d;const t=(d=r.target.files)==null?void 0:d[0];if(!t)return;if(t.size>2*1024*1024){ElMessage.error("文件大小不能超过 2MB");return}if(!t.type.startsWith("image/")){ElMessage.error("请选择图片文件");return}p.value=t;const n=new FileReader;n.onload=M=>{var w;o.value=(w=M.target)==null?void 0:w.result,c.value=o.value},n.readAsDataURL(t)},N=async()=>{var r;if(!(!c.value||i.value)){i.value=!0;try{let a=c.value;if(p.value){const n=new FormData;n.append("avatar",p.value);const d=await D.post("/user/upload-avatar",n,{headers:{"Content-Type":"multipart/form-data"}});if(d.code===0&&((r=d.data)!=null&&r.url))a=d.data.url;else throw new Error(d.msg||"头像上传失败")}const t=await D.put("/user/profile",{avatar:a});t.code===0?(u.user&&(u.user.avatar=a,localStorage.setItem("user",JSON.stringify(u.user))),ElMessage.success("头像更新成功"),b("close")):ElMessage.error(t.msg||"更新失败")}catch(a){ElMessage.error(a.message||"更新失败")}finally{i.value=!1}}};return(r,a)=>{var t;return v(),_("div",{class:"modal-overlay",onClick:a[2]||(a[2]=W(n=>r.$emit("close"),["self"]))},[e("div",se,[e("div",te,[a[3]||(a[3]=e("h3",{class:"modal-title"},"更改头像",-1)),e("button",{class:"modal-close",onClick:a[0]||(a[0]=n=>r.$emit("close"))},"×")]),e("div",ne,[e("div",le,[e("img",{src:o.value||((t=h(u).user)==null?void 0:t.avatar)||"/images/head1.png",alt:"头像预览"},null,8,re)]),e("div",ie,[a[4]||(a[4]=e("h4",null,"选择默认头像",-1)),e("div",ce,[(v(),_(T,null,L(3,n=>e("div",{key:n,class:V(["avatar-option",{active:c.value===`/images/head${n}.png`}]),onClick:d=>g(`/images/head${n}.png`)},[e("img",{src:`/images/head${n}.png`,alt:`头像${n}`},null,8,de)],10,ue)),64))])]),e("div",pe,[a[6]||(a[6]=e("h4",null,"或上传自定义头像",-1)),e("label",ve,[e("input",{type:"file",accept:"image/*",onChange:C,hidden:""},null,32),a[5]||(a[5]=e("span",null,"选择图片",-1))]),a[7]||(a[7]=e("p",{class:"upload-hint"},"支持 JPG、PNG 格式，文件大小不超过 2MB",-1))])]),e("div",ge,[e("button",{class:"btn-cancel",onClick:a[1]||(a[1]=n=>r.$emit("close"))},"取消"),e("button",{class:"btn-confirm",onClick:N,disabled:!c.value||i.value},m(i.value?"保存中...":"确定"),9,fe)])])])}}}),he=z(_e,[["__scopeId","data-v-65d37024"]]),me=()=>{const $=H(),l=G();return{safeNavigate:async(o,i)=>{if(console.log("[Navigation] 尝试导航到:",o),!o)return console.warn("[Navigation] 目标路径为空"),!1;if(l.path===o)return console.log("[Navigation] 已在目标页面"),!0;try{return await K(o,i),console.log("[Navigation] 导航成功 (navigateTo):",o),!0}catch(p){console.warn("[Navigation] navigateTo 失败:",p);try{return await $.push(o),console.log("[Navigation] 导航成功 (router.push):",o),!0}catch(g){return console.error("[Navigation] router.push 也失败了:",g),typeof window<"u"?(console.log("[Navigation] 使用 window.location 进行导航"),window.location.href=o,!0):!1}}},isActive:o=>l.path===o||l.path.startsWith(o+"/"),refreshPage:()=>{typeof window<"u"&&window.location.reload()},currentPath:U(()=>l.path),currentRoute:U(()=>l)}},be={class:"profile-page"},ye={class:"profile-container"},ke={class:"profile-content"},we={class:"profile-sidebar"},$e={class:"user-card"},Ce={class:"user-avatar-section"},Ne=["src","alt"],Me={class:"user-basic-info"},Ae={class:"user-nickname"},xe={class:"user-uid"},Ue={class:"sidebar-menu"},Pe=["src","alt"],Ie={class:"menu-text"},Ee={key:1,class:"menu-badge"},Se={class:"profile-main"},De=R({__name:"profile",setup($){ae({title:"个人中心 - 凡图拉",meta:[{name:"description",content:"凡图拉个人中心，管理您的账户信息、订单、余额和优惠券"},{name:"keywords",content:"个人中心,账户管理,订单查询,凡图拉"}]});const l=B(),b=H(),u=G(),c=f(!1),o=f(0);let i=null;const p=U(()=>[{key:"profile",label:"个人中心",icon:"info1.png",to:"/profile"},{key:"wallet",label:"我的钱包",icon:"info2.png",to:"/profile/wallet"},{key:"orders",label:"我的订单",icon:"info3.png",to:"/profile/orders"},{key:"exchange",label:"兑换中心",icon:"info4.png",to:"/profile/exchange"},{key:"referral",label:"返现推广",icon:"info5.png",to:"/profile/referral"},{key:"tickets",label:"我的工单",icon:"info6.png",to:"/profile/tickets"},{key:"favorites",label:"我的收藏",icon:"info7.png",to:"/profile/favorites"},{key:"messages",label:"我的消息",icon:"info8.png",to:"/profile/messages",badge:o.value>0?o.value:void 0}]),g=async()=>{try{const a=await oe.getUnreadCount();a.code===0&&(o.value=a.data.count||0)}catch(a){console.error("获取未读消息数量失败:",a)}},C=()=>{g(),i=X(()=>{g()},3e4)},N=()=>{i&&(clearInterval(i),i=null)};Q(()=>{console.log("个人中心页面已挂载"),console.log("当前路径:",u.path),console.log("菜单项:",p.value),C()}),j(()=>{N()});const y=a=>u.path===a;me();const k=async()=>{confirm("确定要退出登录吗？")&&(await l.logout(),b.push("/"))},r=()=>{c.value=!1,l.fetchUserInfo()};return(a,t)=>{var P,I,E,S;const n=J,d=ee,M=Z,w=O;return v(),_("div",be,[A(n),e("div",ye,[e("div",ke,[e("div",we,[e("div",$e,[e("div",Ce,[e("img",{src:((P=h(l).user)==null?void 0:P.avatar)||"/images/head1.png",alt:((I=h(l).user)==null?void 0:I.nickname)||"用户头像",class:"user-avatar-large"},null,8,Ne),e("div",Me,[e("h3",Ae,m(((E=h(l).user)==null?void 0:E.nickname)||"张小明"),1),e("p",xe,"UID: "+m(((S=h(l).user)==null?void 0:S.id)||"87654321"),1)])]),e("button",{class:"change-avatar-btn",onClick:t[0]||(t[0]=s=>c.value=!0)},"更改头像")]),e("nav",Ue,[(v(!0),_(T,null,L(p.value,s=>(v(),F(d,{key:s.key,to:s.to,class:V(["menu-item",{active:y(s.to)}])},{default:Y(()=>[s!=null&&s.icon?(v(),_("img",{key:0,src:`/images/${s.icon}`,alt:(s==null?void 0:s.label)||"菜单项",class:"menu-icon"},null,8,Pe)):x("",!0),e("span",Ie,m((s==null?void 0:s.label)||"未知菜单"),1),s!=null&&s.badge?(v(),_("span",Ee,m(s.badge),1)):x("",!0)]),_:2},1032,["to","class"]))),128))]),e("button",{class:"logout-btn",onClick:k},t[1]||(t[1]=[e("i",{class:"logout-icon"},null,-1),q(" 退出登录 ")]))]),e("div",Se,[A(M)])])]),A(w),c.value?(v(),F(he,{key:0,onClose:r})):x("",!0)])}}}),Ve=z(De,[["__scopeId","data-v-b1630864"]]);export{Ve as default};
