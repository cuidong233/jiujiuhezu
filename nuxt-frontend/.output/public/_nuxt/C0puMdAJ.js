import{f as K,r as h,a0 as I,h as Q,g as W,L as R,c as n,K as X,a as s,t as p,m as g,F as E,l as O,j as Y,v as Z,n as V,E as m,o as c,J as ee,_ as te}from"./EcDhdyxl.js";const ae={class:"receipt-modal"},se={class:"modal-header"},le={class:"modal-body"},oe={class:"order-info"},ie={class:"info-item"},re={class:"value"},ne={class:"info-item"},ce={class:"value"},ue={class:"receipt-form"},de={key:0,class:"password-input-wrapper"},pe=["type","value","onInput","placeholder","required","disabled"],ve=["onClick","disabled"],ye=["type","value","onInput","placeholder","required","disabled"],me=["value","onInput","placeholder","required","disabled"],be=["value","onChange","required","disabled"],ge=["value"],he={key:0,class:"form-item"},ke={key:0,class:"receipt-status"},fe={class:"status-info"},qe={key:0,class:"modification-info"},we={class:"modal-footer"},De=["disabled"],_e=K({__name:"ReceiptModal",props:{orderNo:{type:String,required:!0},productName:{type:String,default:""},isViewing:{type:Boolean,default:!1},receiptId:{type:String,default:""}},emits:["close","success"],setup(d,{emit:$}){const q=d,w=$,k=h(!1),r=I({}),v=h([]),o=h(null),i=h(!1),D=h(""),b=I({}),A=Q(()=>o.value?o.value.receiptData&&Object.keys(o.value.receiptData).length>0&&(!o.value.modificationRequest||o.value.modificationRequest.status==="rejected"):!1);W(async()=>{await B()});const B=async()=>{try{const e=await R.getOrderReceipts(q.orderNo);if(e.data&&e.data.receipts&&e.data.receipts.length>0){const t=e.data.receipts[0];o.value=t,t.receiptFields&&Array.isArray(t.receiptFields)?v.value=t.receiptFields.map(l=>({key:l.key||l.name,label:l.label||l.name||l.key,type:l.type||"text",placeholder:l.placeholder||"",required:l.required!==void 0?l.required:!1,options:l.options||[]})):t.receiptFields&&typeof t.receiptFields=="object"?v.value=Object.entries(t.receiptFields).map(([l,y])=>({key:l,label:y.label||l,type:y.type||"text",placeholder:y.placeholder||"",required:y.required||!1,options:y.options||[]})):v.value=x(),_(),t.receiptData&&Object.keys(t.receiptData).length>0&&Object.keys(t.receiptData).forEach(l=>{l in r&&(r[l]=t.receiptData[l])})}else v.value=x(),_()}catch{v.value=x(),_()}},_=()=>{Object.keys(r).forEach(e=>delete r[e]),Object.keys(b).forEach(e=>delete b[e]),v.value.forEach(e=>{r[e.key]="",e.type==="password"&&(b[e.key]=!1)})},f=async(e,t)=>{e in r,r[e]=t,await ee()},T=e=>{b[e]=!b[e]},x=()=>[{key:"gameAccount",label:"游戏账号",type:"text",placeholder:"请输入游戏账号",required:!0},{key:"gamePassword",label:"游戏密码",type:"password",placeholder:"请输入游戏密码",required:!0},{key:"contact",label:"联系方式",type:"text",placeholder:"请输入手机号或邮箱",required:!0},{key:"remark",label:"备注信息",type:"textarea",placeholder:"请输入备注信息（选填）",required:!1}],L=async()=>{for(const e of v.value)if(e.required&&!r[e.key]){typeof m<"u"?m.warning(`请填写${e.label}`):alert(`请填写${e.label}`);return}k.value=!0;try{let e;i.value?e=await R.modifyReceipt(q.orderNo,{receiptData:{...r},reason:D.value}):e=await R.submitReceipt(q.orderNo,{receiptData:{...r}}),e.success||e.code===200?(typeof m<"u"?m.success(i.value?"修改申请已提交":"回执单提交成功"):alert(i.value?"修改申请已提交":"回执单提交成功"),w("success"),w("close")):typeof m<"u"?m.error(e.message||"提交失败"):alert(e.message||"提交失败")}catch(e){typeof m<"u"?m.error(e.message||"提交失败"):alert(e.message||"提交失败")}finally{k.value=!1}},P=()=>{i.value=!0},C=()=>{i.value?i.value=!1:w("close")},z=e=>({pending:"status-pending",completed:"status-completed",processing:"status-processing"})[e]||"status-default",J=e=>({pending:"待填写",completed:"已填写",processing:"处理中"})[e]||e,U=e=>({pending:"mod-pending",approved:"mod-approved",rejected:"mod-rejected"})[e]||"mod-default",G=e=>({pending:"审核中",approved:"已通过",rejected:"已拒绝"})[e]||e;return(e,t)=>{var l,y;return c(),n("div",{class:"modal-mask",onClick:X(C,["self"])},[s("div",ae,[s("div",se,[s("h3",null,p(i.value?"申请修改回执单":(l=o.value)!=null&&l.receiptData?"查看回执单":"填写回执单信息"),1),s("span",{class:"close-btn",onClick:C},"×")]),s("div",le,[s("div",oe,[s("div",ie,[t[1]||(t[1]=s("span",{class:"label"},"订单编号：",-1)),s("span",re,p(d.orderNo),1)]),s("div",ne,[t[2]||(t[2]=s("span",{class:"label"},"商品名称：",-1)),s("span",ce,p(d.productName),1)])]),s("div",ue,[(c(!0),n(E,null,O(v.value,(a,H)=>{var F,j,M,N,S;return c(),n("div",{key:`field-${H}-${a.key}`,class:"form-item"},[s("label",{class:V({required:a.required})},p(a.label),3),a.type==="password"?(c(),n("div",de,[s("input",{type:b[a.key]?"text":"password",value:r[a.key]||"",onInput:u=>f(a.key,u.target.value),placeholder:a.placeholder,required:a.required,disabled:d.isViewing&&((F=o.value)==null?void 0:F.receiptData)&&!i.value,class:"password-input"},null,40,pe),s("button",{type:"button",onClick:u=>T(a.key),class:"password-toggle",disabled:d.isViewing&&((j=o.value)==null?void 0:j.receiptData)&&!i.value},p(b[a.key]?"🙈":"👁️"),9,ve)])):a.type==="text"||a.type==="email"?(c(),n("input",{key:1,type:a.type,value:r[a.key]||"",onInput:u=>f(a.key,u.target.value),placeholder:a.placeholder,required:a.required,disabled:d.isViewing&&((M=o.value)==null?void 0:M.receiptData)&&!i.value},null,40,ye)):a.type==="textarea"?(c(),n("textarea",{key:2,value:r[a.key]||"",onInput:u=>f(a.key,u.target.value),placeholder:a.placeholder,required:a.required,disabled:d.isViewing&&((N=o.value)==null?void 0:N.receiptData)&&!i.value,rows:"3"},null,40,me)):a.type==="select"?(c(),n("select",{key:3,value:r[a.key]||"",onChange:u=>f(a.key,u.target.value),required:a.required,disabled:d.isViewing&&((S=o.value)==null?void 0:S.receiptData)&&!i.value},[t[3]||(t[3]=s("option",{value:""},"请选择",-1)),(c(!0),n(E,null,O(a.options,u=>(c(),n("option",{key:u.value,value:u.value},p(u.label),9,ge))),128))],40,be)):g("",!0)])}),128)),i.value?(c(),n("div",he,[t[4]||(t[4]=s("label",{class:"required"},"修改原因",-1)),Y(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>D.value=a),placeholder:"请说明修改原因",required:"",rows:"3"},null,512),[[Z,D.value]])])):g("",!0)]),o.value&&!i.value?(c(),n("div",ke,[s("div",fe,[t[5]||(t[5]=s("span",{class:"status-label"},"回执状态：",-1)),s("span",{class:V(["status-value",z(o.value.status)])},p(J(o.value.status)),3)]),o.value.modificationRequest?(c(),n("div",qe,[t[6]||(t[6]=s("span",{class:"mod-label"},"修改申请：",-1)),s("span",{class:V(["mod-status",U(o.value.modificationRequest.status)])},p(G(o.value.modificationRequest.status)),3)])):g("",!0)])):g("",!0)]),s("div",we,[!d.isViewing||!((y=o.value)!=null&&y.receiptData)||i.value?(c(),n("button",{key:0,onClick:L,class:"submit-btn",disabled:k.value},p(k.value?"提交中...":i.value?"提交修改申请":"提交回执单"),9,De)):g("",!0),d.isViewing&&A.value&&!i.value?(c(),n("button",{key:1,onClick:P,class:"modify-btn"}," 申请修改 ")):g("",!0),s("button",{onClick:C,class:"cancel-btn"},p(d.isViewing&&!i.value?"关闭":"取消"),1)])])])}}}),Ce=te(_e,[["__scopeId","data-v-7b39a669"]]);export{Ce as R};
