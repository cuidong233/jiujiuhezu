import{n as v}from"./OKUTmN9V.js";import{f as B,u as h,h as x,r as N,g as A,c as u,a as t,m as C,z as _,d as l,t as n,b as c,w as d,F as R,l as z,S as m,o as i,H as V,E as r,_ as D}from"./EcDhdyxl.js";const E={class:"test-notifications-page"},J={class:"user-info"},L={key:0},O={key:1},U={class:"notification-section"},F={class:"manual-test"},M={key:0,class:"notifications-list"},T={class:"debug-info"},H=B({__name:"test-notifications",setup(P){const $=h(),f=x(()=>$.userInfo),p=N([]),o=N(""),y=async()=>{var s;try{o.value=`正在获取通知...
`;const e=await v.getList({page:1,pageSize:20});o.value+=`响应状态: ${e.code||e.status}
`,o.value+=`响应数据: ${JSON.stringify(e,null,2)}
`,e.success||e.code===200?(p.value=e.data.list||[],r.success(`获取到 ${p.value.length} 条通知`)):r.error("获取通知失败")}catch(e){o.value+=`错误: ${e.message}
`,o.value+=`错误详情: ${JSON.stringify((s=e.response)==null?void 0:s.data,null,2)}
`,r.error("获取通知失败: "+e.message)}},S=async()=>{try{const s=await v.getUnreadCount();(s.success||s.code===200)&&(r.success(`未读通知数量: ${s.data.count}`),o.value=`未读数量: ${s.data.count}
`)}catch(s){r.error("获取未读数量失败: "+s.message),o.value=`错误: ${s.message}
`}},b=async s=>{try{await v.markAsRead(s),r.success("已标记为已读"),await y()}catch(e){r.error("标记失败: "+e.message)}};return A(()=>{o.value=`用户信息: ${JSON.stringify(f.value,null,2)}
`,o.value+=`Token: ${localStorage.getItem("token")?"存在":"不存在"}
`}),(s,e)=>{const w=m("NotificationBell"),g=m("el-button"),k=m("el-tag"),I=m("el-card");return i(),u("div",E,[e[9]||(e[9]=t("h1",null,"通知测试页面",-1)),t("div",J,[e[2]||(e[2]=t("h2",null,"当前用户信息",-1)),_(f)?(i(),u("p",L,[l(" 用户ID: "+n(_(f).id),1),e[0]||(e[0]=t("br",null,null,-1)),l(" 邮箱: "+n(_(f).email),1),e[1]||(e[1]=t("br",null,null,-1)),l(" 昵称: "+n(_(f).nickname),1)])):(i(),u("p",O,"未登录"))]),t("div",U,[e[3]||(e[3]=t("h2",null,"通知铃铛组件",-1)),c(w)]),t("div",F,[e[6]||(e[6]=t("h2",null,"手动测试通知API",-1)),c(g,{onClick:y},{default:d(()=>e[4]||(e[4]=[l("获取通知")])),_:1,__:[4]}),c(g,{onClick:S},{default:d(()=>e[5]||(e[5]=[l("获取未读数量")])),_:1,__:[5]})]),p.value.length>0?(i(),u("div",M,[t("h3",null,"通知列表 ("+n(p.value.length)+" 条)",1),(i(!0),u(R,null,z(p.value,a=>(i(),u("div",{key:a.id,class:"notification-item"},[c(I,null,{default:d(()=>[t("h4",null,n(a.title),1),t("p",null,n(a.content),1),t("p",null,[c(k,{type:a.isRead?"info":"danger"},{default:d(()=>[l(n(a.isRead?"已读":"未读"),1)]),_:2},1032,["type"]),c(k,null,{default:d(()=>[l(n(a.type),1)]),_:2},1024)]),t("p",null,"时间: "+n(new Date(a.createdAt).toLocaleString("zh-CN")),1),a.isRead?C("",!0):(i(),V(g,{key:0,onClick:j=>b(a.id),size:"small"},{default:d(()=>e[7]||(e[7]=[l(" 标记已读 ")])),_:2,__:[7]},1032,["onClick"]))]),_:2},1024)]))),128))])):C("",!0),t("div",T,[e[8]||(e[8]=t("h3",null,"调试信息",-1)),t("pre",null,n(o.value),1)])])}}}),K=D(H,[["__scopeId","data-v-44d960cf"]]);export{K as default};
