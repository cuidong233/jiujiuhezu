import{f as $,r as d,h as S,g as C,c as m,o as u,a,m as g,F as D,l as x,n as _,t as c,j as B,v as L,O as f,_ as R,H as N}from"./EcDhdyxl.js";import{_ as U}from"./DcjaKIUg.js";import{_ as V}from"./Dw_Z4xcU.js";const W={class:"modal-mask"},E={class:"wallet-recharge-modal"},I={class:"modal-header"},O={class:"modal-content"},P={class:"amount-options"},z=["onClick"],A={class:"amount-main"},j={key:0,class:"custom-amount-row"},H={class:"pay-methods"},Y={key:1,class:"binance-rate-info"},q={class:"rate-header"},G=["disabled"],J={class:"rate-content"},K={class:"rate-item"},Q={class:"rate-value"},X={class:"rate-item"},Z={class:"rate-value"},aa={class:"rate-source"},ta=$({__name:"WalletRechargeModal",emits:["close"],setup(T,{emit:y}){const b=y,p=[{value:50},{value:100},{value:200},{value:500}],i=d(0),v=d(null),o=d("alipay"),n=d(!1),e=d({buy:7.35,sell:7.25,mid:7.3,spread:.1,source:"Binance P2P"}),h=S(()=>((i.value>=0?p[i.value].value:v.value||0)/e.value.sell).toFixed(2));async function l(){n.value=!0;try{const s=await f.get("/binance/rate/usdt-cny");s&&s.data&&(e.value=s.data)}catch(s){console.error("获取汇率失败:",s)}finally{n.value=!1}}function F(){o.value="binance",e.value.timestamp||l()}function w(s){i.value=s,s!==-1&&(v.value=null)}async function M(){const s=i.value>=0?p[i.value].value:v.value;if(!s||s<=0){alert("请选择或输入充值金额");return}try{if(o.value==="binance"){const t=await f.post("/binance/pay/create",{orderNo:"ORD"+Date.now(),amount:s,currency:"USDT",description:"钱包充值"});t&&t.data&&window.open(t.data,"_blank")}else if(o.value==="wechat"){const t=await f.post("/wechat/pay/create",{orderNo:"WALLET_"+Date.now(),amount:Number(s),description:"钱包充值",payType:"native"});t&&t.data&&(window.location.href=t.data)}else{const t=await f.post("/payment/alipay/create",{amount:s,description:"钱包充值"});t&&t.data&&(window.location.href=t.data)}b("close")}catch(t){console.error("充值失败:",t),alert("充值失败，请稍后重试")}}return C(()=>{l()}),(s,t)=>(u(),m("div",W,[a("div",E,[a("div",I,[t[5]||(t[5]=a("div",{class:"modal-title"},"充值",-1)),t[6]||(t[6]=a("div",{class:"modal-subtitle"},"为您的余额充值吧！",-1)),a("button",{class:"modal-close",onClick:t[0]||(t[0]=r=>s.$emit("close"))},"×")]),a("div",O,[t[14]||(t[14]=a("div",{class:"section-label"},"充值",-1)),a("div",P,[(u(),m(D,null,x(p,(r,k)=>a("div",{key:r.value,class:_(["amount-option",{active:i.value===k}]),onClick:ma=>w(k)},[a("div",A,"¥"+c(r.value),1)],10,z)),64)),a("div",{class:_(["amount-option","custom-option",{active:i.value===-1}]),onClick:t[1]||(t[1]=r=>w(-1))},t[7]||(t[7]=[a("span",null,"自定义",-1)]),2)]),i.value===-1?(u(),m("div",j,[B(a("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>v.value=r),type:"number",min:"1",placeholder:"请输入充值金额"},null,512),[[L,v.value,void 0,{number:!0}]])])):g("",!0),t[15]||(t[15]=a("div",{class:"section-label pay-label"},"选择支付方式",-1)),a("div",H,[a("div",{class:_(["pay-method",o.value==="alipay"?"active":""]),onClick:t[3]||(t[3]=r=>o.value="alipay")},t[8]||(t[8]=[a("div",{class:"pay-method-content"},[a("img",{class:"pay-icon",src:U,alt:"支付宝"}),a("span",null,"支付宝")],-1)]),2),a("div",{class:_(["pay-method",o.value==="wechat"?"active":""]),onClick:t[4]||(t[4]=r=>o.value="wechat")},t[9]||(t[9]=[a("div",{class:"pay-method-content"},[a("img",{class:"pay-icon",src:V,alt:"微信支付"}),a("span",null,"微信支付")],-1)]),2),a("div",{class:_(["pay-method",o.value==="binance"?"active":""]),onClick:F},t[10]||(t[10]=[a("div",{class:"pay-method-content"},[a("span",{style:{"font-size":"24px","margin-right":"12px"}},"₮"),a("span",null,"USDT充值")],-1)]),2)]),o.value==="binance"?(u(),m("div",Y,[a("div",q,[t[11]||(t[11]=a("span",{class:"rate-title"},"实时汇率",-1)),a("button",{class:"rate-refresh",onClick:l,disabled:n.value},c(n.value?"刷新中...":"刷新"),9,G)]),a("div",J,[a("div",K,[t[12]||(t[12]=a("span",{class:"rate-label"},"USDT/CNY：",-1)),a("span",Q,"¥"+c(e.value.sell),1)]),a("div",X,[t[13]||(t[13]=a("span",{class:"rate-label"},"充值金额：",-1)),a("span",Z,c(h.value)+" USDT",1)]),a("div",aa,"数据来源："+c(e.value.source),1)])])):g("",!0),a("button",{class:"btn-confirm",onClick:M},"立即充值")]),t[16]||(t[16]=a("div",{class:"modal-bottom-blank"},null,-1))])]))}}),sa=R(ta,[["__scopeId","data-v-00bcbd3a"]]),ea={class:"wallet-section"},oa={class:"balance-card"},na={class:"balance-content"},la={class:"balance-amount"},ia={class:"balance-details"},ca={class:"transaction-list"},ra={class:"transaction-info"},da={class:"transaction-title"},ua={class:"transaction-time"},va=$({__name:"wallet",setup(T){const y=d(!1),b=d(0),p=d([]),i=async()=>{try{const n=await f.get("/wallet/info");n&&n.data&&(b.value=n.data.balance);const e=await f.get("/wallet/transactions");e&&e.data&&(p.value=e.data)}catch(n){console.error("获取钱包信息失败:",n)}},v=()=>{y.value=!0},o=()=>{y.value=!1};return C(i),(n,e)=>{const h=sa;return u(),m("div",ea,[e[2]||(e[2]=a("div",{class:"section-header"},[a("h2",{class:"section-title"},"我的钱包")],-1)),a("div",oa,[a("div",na,[e[0]||(e[0]=a("div",{class:"balance-label"},"可用余额",-1)),a("div",la,"¥ "+c(b.value.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})??"0.00"),1),a("button",{class:"recharge-btn",onClick:v},"去充值")])]),a("div",ia,[e[1]||(e[1]=a("div",{class:"details-header"},[a("h3",{class:"details-title"},"余额明细")],-1)),a("div",ca,[(u(!0),m(D,null,x(p.value,l=>(u(),m("div",{class:"transaction-item",key:l.id},[a("div",ra,[a("div",da,c(l.type),1),a("div",ua,c(l.created_at),1)]),a("div",{class:_(["transaction-amount",{positive:l.amount>0,negative:l.amount<0}])},c(l.amount>0?"+":"")+c((l.amount||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),3)]))),128))])]),y.value?(u(),N(h,{key:0,onClose:o})):g("",!0)])}}}),ya=R(va,[["__scopeId","data-v-c942fcb0"]]);export{ya as default};
